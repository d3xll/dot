<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞ "–î—É—Ä–∞–∫"</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Russo+One&display=swap');
        
        * {
            font-family: 'Russo One', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a472a 0%, #0d2818 50%, #1a472a 100%);
            min-height: 100vh;
            overflow: hidden;
        }
        
        .card {
            width: 70px;
            height: 100px;
            background: linear-gradient(145deg, #ffffff 0%, #f0f0f0 100%);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px;
            user-select: none;
            backface-visibility: hidden;
        }
        
        .card:hover:not(.card-back):not(.disabled) {
            transform: translateY(-15px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0,0,0,0.4);
            z-index: 100;
        }
        
        .card.selected {
            transform: translateY(-20px) scale(1.1);
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.5);
            border: 3px solid gold;
        }
        
        .card-back {
            background: linear-gradient(145deg, #2c3e8c 0%, #1a237e 100%);
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
        }
        
        .card-back::after {
            content: 'üÉè';
            font-size: 30px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .suit-red { color: #c62828; }
        .suit-black { color: #212121; }
        
        .trump-indicator {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.9); }
        }
        
        @keyframes dealCard {
            0% { 
                transform: translate(-50%, -50%) scale(0.5) rotate(180deg);
                opacity: 0;
            }
            100% { 
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        @keyframes flyToTable {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes takeCards {
            0% { opacity: 1; }
            100% { opacity: 0; transform: translateX(100px); }
        }
        
        .dealing {
            animation: dealCard 0.5s ease-out forwards;
        }
        
        .flying {
            animation: flyToTable 0.3s ease-out;
        }
        
        .taking {
            animation: takeCards 0.4s ease-out forwards;
        }
        
        .btn-game {
            background: linear-gradient(145deg, #ffd700 0%, #ffb300 100%);
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .btn-game:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
        }
        
        .btn-game:active {
            transform: scale(0.98);
        }
        
        .difficulty-btn {
            transition: all 0.3s ease;
        }
        
        .difficulty-btn:hover {
            transform: translateY(-5px);
        }
        
        .game-message {
            animation: fadeInUp 0.5s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .deck-counter {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        #confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body class="flex items-center justify-center">
    <!-- –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
    <div id="menu" class="text-center">
        <h1 class="text-6xl text-yellow-400 mb-4 drop-shadow-lg">üÉè –î–£–†–ê–ö üÉè</h1>
        <p class="text-white text-xl mb-8">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞</p>
        
        <div class="mb-8">
            <p class="text-yellow-200 text-lg mb-4">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å:</p>
            <div class="flex gap-4 justify-center flex-wrap">
                <button onclick="startGame('easy')" class="difficulty-btn bg-green-500 hover:bg-green-400 text-white px-8 py-4 rounded-xl text-xl shadow-lg">
                    üòä –õ–µ–≥–∫–æ
                </button>
                <button onclick="startGame('medium')" class="difficulty-btn bg-yellow-500 hover:bg-yellow-400 text-white px-8 py-4 rounded-xl text-xl shadow-lg">
                    ü§î –°—Ä–µ–¥–Ω–µ
                </button>
                <button onclick="startGame('hard')" class="difficulty-btn bg-red-500 hover:bg-red-400 text-white px-8 py-4 rounded-xl text-xl shadow-lg">
                    üòà –°–ª–æ–∂–Ω–æ
                </button>
            </div>
        </div>
        
        <div class="text-gray-300 text-sm max-w-md mx-auto">
            <p>–ü—Ä–∞–≤–∏–ª–∞: –∏–∑–±–∞–≤—å—Ç–µ—Å—å –æ—Ç –≤—Å–µ—Ö –∫–∞—Ä—Ç —Ä–∞–Ω—å—à–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞.</p>
            <p>–ë–µ–π—Ç–µ –∫–∞—Ä—Ç—ã —Å—Ç–∞—Ä—à–∏–º–∏ –∫–∞—Ä—Ç–∞–º–∏ —Ç–æ–π –∂–µ –º–∞—Å—Ç–∏ –∏–ª–∏ –∫–æ–∑—ã—Ä—è–º–∏.</p>
        </div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
    <div id="gameBoard" class="hidden w-full h-screen relative">
        <!-- –ö–∞—Ä—Ç—ã –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ -->
        <div id="aiHand" class="absolute top-4 left-1/2 transform -translate-x-1/2 flex justify-center h-24">
        </div>
        
        <!-- –ö–æ–ª–æ–¥–∞ –∏ –∫–æ–∑—ã—Ä—å -->
        <div id="deckArea" class="absolute left-8 top-1/2 transform -translate-y-1/2">
            <div id="deck" class="relative">
                <div id="trumpCard" class="card"></div>
                <div id="deckPile" class="card card-back" style="left: 20px; top: -5px;"></div>
            </div>
            <div id="deckCount" class="deck-counter text-white text-center mt-2 px-3 py-1 rounded-lg">
                –ö–æ–ª–æ–¥–∞: <span id="deckNumber">36</span>
            </div>
        </div>
        
        <!-- –°—Ç–æ–ª (–ø–æ–ª–µ –±–æ—è) -->
        <div id="table" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
                              w-[600px] h-[180px] bg-green-900/50 rounded-3xl border-4 border-yellow-600/50
                              flex items-center justify-center gap-4 px-4">
            <div id="tableCards" class="flex gap-4 items-center justify-center flex-wrap"></div>
        </div>
        
        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ -->
        <div id="gameMessage" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
                                     text-2xl text-yellow-400 font-bold hidden game-message z-50
                                     bg-black/70 px-6 py-3 rounded-xl"></div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div id="controls" class="absolute bottom-32 left-1/2 transform -translate-x-1/2 flex gap-4">
            <button id="btnTake" onclick="takeCards()" class="hidden btn-game px-6 py-3 rounded-xl text-lg font-bold text-gray-800">
                üì• –í–∑—è—Ç—å
            </button>
            <button id="btnPass" onclick="passTurn()" class="hidden btn-game px-6 py-3 rounded-xl text-lg font-bold text-gray-800">
                ‚úÖ –ë–∏—Ç–æ
            </button>
            <button id="btnAdd" onclick="addCards()" class="hidden btn-game px-6 py-3 rounded-xl text-lg font-bold text-gray-800">
                ‚ûï –ü–æ–¥–∫–∏–Ω—É—Ç—å
            </button>
        </div>
        
        <!-- –ö–∞—Ä—Ç—ã –∏–≥—Ä–æ–∫–∞ -->
        <div id="playerHand" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex justify-center h-28">
        </div>
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ö–æ–¥–∞ -->
        <div id="turnIndicator" class="absolute top-4 right-4 text-xl px-4 py-2 rounded-xl"></div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é -->
        <button onclick="backToMenu()" class="absolute top-4 left-4 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
            ‚Üê –ú–µ–Ω—é
        </button>
    </div>
    
    <canvas id="confetti"></canvas>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const SUITS = ['‚ô†', '‚ô£', '‚ô•', '‚ô¶'];
        const SUIT_NAMES = { '‚ô†': 'spades', '‚ô£': 'clubs', '‚ô•': 'hearts', '‚ô¶': 'diamonds' };
        const VALUES = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        const VALUE_POWER = { '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14 };
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let deck = [];
        let playerHand = [];
        let aiHand = [];
        let tableCards = []; // [{attack: card, defense: card|null}, ...]
        let trumpSuit = '';
        let isPlayerTurn = true;
        let isPlayerAttacking = true;
        let difficulty = 'medium';
        let gameOver = false;
        let selectedCard = null;
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–æ–¥—ã
        function createDeck() {
            const newDeck = [];
            for (const suit of SUITS) {
                for (const value of VALUES) {
                    newDeck.push({
                        suit,
                        value,
                        power: VALUE_POWER[value],
                        isRed: suit === '‚ô•' || suit === '‚ô¶',
                        id: `${value}${suit}`
                    });
                }
            }
            return shuffle(newDeck);
        }
        
        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ
        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }
        
        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame(diff) {
            difficulty = diff;
            deck = createDeck();
            playerHand = [];
            aiHand = [];
            tableCards = [];
            gameOver = false;
            selectedCard = null;
            
            // –ö–æ–∑—ã—Ä—å
            trumpSuit = deck[0].suit;
            
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('gameBoard').classList.remove('hidden');
            
            // –†–∞–∑–¥–∞—á–∞ –∫–∞—Ä—Ç
            dealCards();
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫—Ç–æ —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º (—É –∫–æ–≥–æ –º–µ–Ω—å—à–∏–π –∫–æ–∑—ã—Ä—å)
            setTimeout(() => {
                determineFirstPlayer();
                updateUI();
            }, 2000);
        }
        
        // –†–∞–∑–¥–∞—á–∞ –∫–∞—Ä—Ç
        function dealCards() {
            let delay = 0;
            
            for (let i = 0; i < 6; i++) {
                if (deck.length > 1) {
                    setTimeout(() => {
                        playerHand.push(deck.pop());
                        renderHands();
                    }, delay);
                    delay += 150;
                }
                
                if (deck.length > 1) {
                    setTimeout(() => {
                        aiHand.push(deck.pop());
                        renderHands();
                    }, delay);
                    delay += 150;
                }
            }
            
            setTimeout(renderDeck, delay);
        }
        
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        function determineFirstPlayer() {
            let playerMinTrump = Infinity;
            let aiMinTrump = Infinity;
            
            for (const card of playerHand) {
                if (card.suit === trumpSuit && card.power < playerMinTrump) {
                    playerMinTrump = card.power;
                }
            }
            
            for (const card of aiHand) {
                if (card.suit === trumpSuit && card.power < aiMinTrump) {
                    aiMinTrump = card.power;
                }
            }
            
            isPlayerAttacking = playerMinTrump <= aiMinTrump;
            isPlayerTurn = isPlayerAttacking;
            
            showMessage(isPlayerAttacking ? '–í–∞—à —Ö–æ–¥!' : '–•–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞', 1500);
            
            if (!isPlayerTurn) {
                setTimeout(aiPlay, 2000);
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–ª–æ–¥—ã
        function renderDeck() {
            const trumpCard = document.getElementById('trumpCard');
            const deckPile = document.getElementById('deckPile');
            const deckNumber = document.getElementById('deckNumber');
            
            deckNumber.textContent = deck.length;
            
            if (deck.length > 0) {
                const card = deck[0];
                trumpCard.innerHTML = `
                    <div class="text-xs ${card.isRed ? 'suit-red' : 'suit-black'}">${card.value}${card.suit}</div>
                    <div class="text-2xl ${card.isRed ? 'suit-red' : 'suit-black'} text-center">${card.suit}</div>
                    <div class="text-xs ${card.isRed ? 'suit-red' : 'suit-black'} text-right transform rotate-180">${card.value}${card.suit}</div>
                `;
                trumpCard.className = 'card trump-indicator';
                trumpCard.style.transform = 'rotate(90deg)';
                trumpCard.style.left = '-20px';
                trumpCard.style.top = '10px';
                trumpCard.style.position = 'absolute';
            } else {
                trumpCard.style.display = 'none';
            }
            
            deckPile.style.display = deck.length > 1 ? 'block' : 'none';
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä—É–∫
        function renderHands() {
            renderPlayerHand();
            renderAIHand();
        }
        
        function renderPlayerHand() {
            const container = document.getElementById('playerHand');
            container.innerHTML = '';
            
            const totalWidth = Math.min(playerHand.length * 50, 600);
            const startX = -totalWidth / 2;
            const cardSpacing = playerHand.length > 1 ? totalWidth / (playerHand.length - 1) : 0;
            
            playerHand.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = `card dealing ${card.isRed ? 'suit-red' : 'suit-black'} ${selectedCard === card ? 'selected' : ''}`;
                cardEl.style.left = `${startX + index * (cardSpacing || 0)}px`;
                cardEl.style.animationDelay = `${index * 0.05}s`;
                cardEl.style.zIndex = index;
                
                cardEl.innerHTML = `
                    <div class="text-xs font-bold">${card.value}${card.suit}</div>
                    <div class="text-2xl text-center">${card.suit}</div>
                    <div class="text-xs font-bold text-right transform rotate-180">${card.value}${card.suit}</div>
                `;
                
                if (card.suit === trumpSuit) {
                    cardEl.style.borderBottom = '3px solid gold';
                }
                
                cardEl.onclick = () => handleCardClick(card, index);
                container.appendChild(cardEl);
            });
        }
        
        function renderAIHand() {
            const container = document.getElementById('aiHand');
            container.innerHTML = '';
            
            const totalWidth = Math.min(aiHand.length * 40, 500);
            const startX = -totalWidth / 2;
            const cardSpacing = aiHand.length > 1 ? totalWidth / (aiHand.length - 1) : 0;
            
            aiHand.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card card-back dealing';
                cardEl.style.left = `${startX + index * (cardSpacing || 0)}px`;
                cardEl.style.animationDelay = `${index * 0.05}s`;
                cardEl.style.zIndex = index;
                cardEl.style.transform = 'scale(0.9)';
                container.appendChild(cardEl);
            });
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—Ç–æ–ª–∞
        function renderTable() {
            const container = document.getElementById('tableCards');
            container.innerHTML = '';
            
            tableCards.forEach((pair, index) => {
                const pairDiv = document.createElement('div');
                pairDiv.className = 'relative';
                pairDiv.style.width = '80px';
                pairDiv.style.height = '120px';
                
                // –ê—Ç–∞–∫—É—é—â–∞—è –∫–∞—Ä—Ç–∞
                const attackCard = createCardElement(pair.attack);
                attackCard.style.position = 'absolute';
                attackCard.style.left = '0';
                attackCard.style.top = '0';
                attackCard.classList.add('flying');
                pairDiv.appendChild(attackCard);
                
                // –ó–∞—â–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞
                if (pair.defense) {
                    const defenseCard = createCardElement(pair.defense);
                    defenseCard.style.position = 'absolute';
                    defenseCard.style.left = '15px';
                    defenseCard.style.top = '20px';
                    defenseCard.classList.add('flying');
                    pairDiv.appendChild(defenseCard);
                }
                
                container.appendChild(pairDiv);
            });
        }
        
        function createCardElement(card) {
            const cardEl = document.createElement('div');
            cardEl.className = `card ${card.isRed ? 'suit-red' : 'suit-black'}`;
            cardEl.style.position = 'relative';
            cardEl.style.cursor = 'default';
            cardEl.innerHTML = `
                <div class="text-xs font-bold">${card.value}${card.suit}</div>
                <div class="text-2xl text-center">${card.suit}</div>
                <div class="text-xs font-bold text-right transform rotate-180">${card.value}${card.suit}</div>
            `;
            if (card.suit === trumpSuit) {
                cardEl.style.borderBottom = '3px solid gold';
            }
            return cardEl;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
        function handleCardClick(card, index) {
            if (!isPlayerTurn || gameOver) return;
            
            if (selectedCard === card) {
                // –ò–≥—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É
                playCard(card, index);
            } else {
                selectedCard = card;
                renderPlayerHand();
            }
        }
        
        // –ò–≥—Ä–∞—Ç—å –∫–∞—Ä—Ç—É
        function playCard(card, index) {
            if (isPlayerAttacking) {
                // –ê—Ç–∞–∫–∞
                if (!canAttack(card)) {
                    showMessage('–ù–µ–ª—å–∑—è –ø–æ–¥–∫–∏–Ω—É—Ç—å —ç—Ç—É –∫–∞—Ä—Ç—É!', 1000);
                    return;
                }
                
                playerHand.splice(index, 1);
                tableCards.push({ attack: card, defense: null });
                selectedCard = null;
                
                renderHands();
                renderTable();
                updateUI();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
                if (checkWin()) return;
                
                // –•–æ–¥ –ò–ò –∑–∞—â–∏—â–∞—Ç—å—Å—è
                isPlayerTurn = false;
                setTimeout(aiDefend, 1000);
                
            } else {
                // –ó–∞—â–∏—Ç–∞
                const unbeatIndex = tableCards.findIndex(p => p.defense === null);
                if (unbeatIndex === -1) return;
                
                const attackCard = tableCards[unbeatIndex].attack;
                
                if (!canBeat(card, attackCard)) {
                    showMessage('–≠—Ç–∞ –∫–∞—Ä—Ç–∞ –Ω–µ –±—å—ë—Ç!', 1000);
                    return;
                }
                
                playerHand.splice(index, 1);
                tableCards[unbeatIndex].defense = card;
                selectedCard = null;
                
                renderHands();
                renderTable();
                updateUI();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
                if (checkWin()) return;
            }
        }
        
        // –ú–æ–∂–Ω–æ –ª–∏ –∞—Ç–∞–∫–æ–≤–∞—Ç—å —ç—Ç–æ–π –∫–∞—Ä—Ç–æ–π
        function canAttack(card) {
            if (tableCards.length === 0) return true;
            if (tableCards.length >= 6) return false;
            if (tableCards.length >= aiHand.length) return false;
            
            // –ú–æ–∂–Ω–æ –ø–æ–¥–∫–∏–¥—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç—ã —Ç–æ–≥–æ –∂–µ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞
            for (const pair of tableCards) {
                if (pair.attack.value === card.value) return true;
                if (pair.defense && pair.defense.value === card.value) return true;
            }
            return false;
        }
        
        // –ú–æ–∂–Ω–æ –ª–∏ –ø–æ–±–∏—Ç—å –∫–∞—Ä—Ç—É
        function canBeat(defense, attack) {
            if (defense.suit === attack.suit) {
                return defense.power > attack.power;
            }
            if (defense.suit === trumpSuit && attack.suit !== trumpSuit) {
                return true;
            }
            return false;
        }
        
        // –ò–ò –∞—Ç–∞–∫–∞
        function aiPlay() {
            if (gameOver || isPlayerTurn) return;
            
            const card = selectAIAttackCard();
            
            if (card) {
                const index = aiHand.indexOf(card);
                aiHand.splice(index, 1);
                tableCards.push({ attack: card, defense: null });
                
                renderHands();
                renderTable();
                updateUI();
                
                if (checkWin()) return;
                
                isPlayerTurn = true;
                updateUI();
            } else {
                // –ò–ò –Ω–µ –º–æ–∂–µ—Ç –∞—Ç–∞–∫–æ–≤–∞—Ç—å - –±–∏—Ç–æ
                endRound(true);
            }
        }
        
        // –í—ã–±–æ—Ä –∫–∞—Ä—Ç—ã –¥–ª—è –∞—Ç–∞–∫–∏ –ò–ò
        function selectAIAttackCard() {
            const playable = aiHand.filter(c => canAttack(c));
            if (playable.length === 0) return null;
            
            if (tableCards.length >= 6 || tableCards.length >= playerHand.length) return null;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å–∏–ª–µ
            playable.sort((a, b) => {
                const aIsTrump = a.suit === trumpSuit ? 1 : 0;
                const bIsTrump = b.suit === trumpSuit ? 1 : 0;
                if (aIsTrump !== bIsTrump) return aIsTrump - bIsTrump;
                return a.power - b.power;
            });
            
            if (difficulty === 'easy') {
                // –õ–µ–≥–∫–∏–π - —Å–ª—É—á–∞–π–Ω–∞—è –∫–∞—Ä—Ç–∞
                return playable[Math.floor(Math.random() * playable.length)];
            } else if (difficulty === 'medium') {
                // –°—Ä–µ–¥–Ω–∏–π - —Å–∞–º–∞—è —Å–ª–∞–±–∞—è –Ω–µ –∫–æ–∑—ã—Ä—å
                return playable[0];
            } else {
                // –°–ª–æ–∂–Ω—ã–π - —É–º–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–∏–Ω—É—Ç—å —Ç–æ, —á—Ç–æ –∏–≥—Ä–æ–∫ –Ω–µ —Å–º–æ–∂–µ—Ç –ø–æ–±–∏—Ç—å
                const playerCanBeat = playable.filter(c => {
                    return !playerHand.some(pc => canBeat(pc, c));
                });
                if (playerCanBeat.length > 0) {
                    return playerCanBeat[0];
                }
                return playable[0];
            }
        }
        
        // –ò–ò –∑–∞—â–∏—Ç–∞
        function aiDefend() {
            if (gameOver || isPlayerTurn) return;
            
            const unbeaten = tableCards.filter(p => p.defense === null);
            
            for (const pair of unbeaten) {
                const defender = selectAIDefenseCard(pair.attack);
                
                if (defender) {
                    const index = aiHand.indexOf(defender);
                    aiHand.splice(index, 1);
                    pair.defense = defender;
                    
                    renderHands();
                    renderTable();
                    updateUI();
                    
                    if (checkWin()) return;
                } else {
                    // –ò–ò –±–µ—Ä—ë—Ç
                    showMessage('–ö–æ–º–ø—å—é—Ç–µ—Ä –±–µ—Ä—ë—Ç!', 1500);
                    setTimeout(() => {
                        endRound(false, true);
                    }, 1000);
                    return;
                }
            }
            
            // –ò–ò –æ—Ç–±–∏–ª—Å—è
            isPlayerTurn = true;
            updateUI();
        }
        
        // –í—ã–±–æ—Ä –∫–∞—Ä—Ç—ã –¥–ª—è –∑–∞—â–∏—Ç—ã –ò–ò
        function selectAIDefenseCard(attack) {
            const canBeatCards = aiHand.filter(c => canBeat(c, attack));
            if (canBeatCards.length === 0) return null;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º
            canBeatCards.sort((a, b) => {
                const aIsTrump = a.suit === trumpSuit ? 1 : 0;
                const bIsTrump = b.suit === trumpSuit ? 1 : 0;
                if (aIsTrump !== bIsTrump) return aIsTrump - bIsTrump;
                return a.power - b.power;
            });
            
            if (difficulty === 'easy') {
                // –ë–µ—Ä—ë–º –≤ 30% —Å–ª—É—á–∞–µ–≤ –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–∑—ã—Ä—å
                if (Math.random() < 0.3 && canBeatCards[0].suit === trumpSuit) {
                    return null;
                }
                return canBeatCards[Math.floor(Math.random() * canBeatCards.length)];
            } else if (difficulty === 'medium') {
                return canBeatCards[0];
            } else {
                // –°–ª–æ–∂–Ω—ã–π - –Ω–µ —Ç—Ä–∞—Ç–∏–º –∫–æ–∑—ã—Ä–∏ –Ω–∞ –º–µ–ª–æ—á—å –µ—Å–ª–∏ –º–æ–∂–Ω–æ
                const nonTrump = canBeatCards.filter(c => c.suit !== trumpSuit);
                if (nonTrump.length > 0) {
                    return nonTrump[0];
                }
                // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –∫–æ–∑—ã—Ä–∏ - –±—å—ë–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞—Ç–∞–∫–∞ —Å–∏–ª—å–Ω–∞—è
                if (attack.power >= 10 || tableCards.length > 3) {
                    return canBeatCards[0];
                }
                return null; // –ë–µ—Ä—ë–º
            }
        }
        
        // –ò–≥—Ä–æ–∫ –±–µ—Ä—ë—Ç
        function takeCards() {
            if (!isPlayerTurn || isPlayerAttacking || gameOver) return;
            
            showMessage('–í—ã –±–µ—Ä—ë—Ç–µ –∫–∞—Ä—Ç—ã', 1000);
            endRound(false, false);
        }
        
        // –ë–∏—Ç–æ
        function passTurn() {
            if (!isPlayerTurn || gameOver) return;
            
            if (isPlayerAttacking) {
                // –ò–≥—Ä–æ–∫ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç –∞—Ç–∞–∫—É
                if (tableCards.every(p => p.defense !== null)) {
                    endRound(true);
                }
            } else {
                // –ò–≥—Ä–æ–∫ –æ—Ç–±–∏–ª—Å—è - —Ç–µ–ø–µ—Ä—å –ò–ò –º–æ–∂–µ—Ç –ø–æ–¥–∫–∏–Ω—É—Ç—å
                isPlayerTurn = false;
                setTimeout(() => {
                    const canAdd = aiHand.some(c => canAttack(c)) && tableCards.length < 6;
                    if (canAdd && Math.random() > 0.3) {
                        aiPlay();
                    } else {
                        endRound(true);
                    }
                }, 500);
            }
        }
        
        // –ü–æ–¥–∫–∏–Ω—É—Ç—å
        function addCards() {
            if (!isPlayerTurn || !isPlayerAttacking || gameOver) return;
            
            const canAdd = playerHand.some(c => canAttack(c));
            if (!canAdd || tableCards.length >= 6) {
                showMessage('–ù–µ—á–µ–≥–æ –ø–æ–¥–∫–∏–Ω—É—Ç—å!', 1000);
                return;
            }
            
            showMessage('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É –¥–ª—è –ø–æ–¥–∫–∏–¥—ã–≤–∞–Ω–∏—è', 1000);
        }
        
        // –ö–æ–Ω–µ—Ü —Ä–∞—É–Ω–¥–∞
        function endRound(beaten, aiTakes = false) {
            const allCards = [];
            tableCards.forEach(p => {
                allCards.push(p.attack);
                if (p.defense) allCards.push(p.defense);
            });
            
            if (!beaten) {
                // –ö—Ç–æ-—Ç–æ –±–µ—Ä—ë—Ç
                if (aiTakes) {
                    aiHand.push(...allCards);
                } else {
                    playerHand.push(...allCards);
                }
            }
            
            // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–æ–ª–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            const tableEl = document.getElementById('tableCards');
            tableEl.querySelectorAll('.card').forEach(c => c.classList.add('taking'));
            
            setTimeout(() => {
                tableCards = [];
                renderTable();
                
                // –î–æ–±–æ—Ä –∫–∞—Ä—Ç
                refillHands();
                
                setTimeout(() => {
                    if (checkWin()) return;
                    
                    // –°–º–µ–Ω–∞ –∞—Ç–∞–∫—É—é—â–µ–≥–æ
                    if (beaten) {
                        isPlayerAttacking = !isPlayerAttacking;
                    }
                    // –ï—Å–ª–∏ –≤–∑—è–ª–∏ - –∞—Ç–∞–∫—É—é—â–∏–π –æ—Å—Ç–∞—ë—Ç—Å—è
                    
                    isPlayerTurn = isPlayerAttacking;
                    selectedCard = null;
                    
                    renderHands();
                    updateUI();
                    
                    showMessage(isPlayerAttacking ? '–í–∞—à —Ö–æ–¥!' : '–•–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞', 1000);
                    
                    if (!isPlayerTurn) {
                        setTimeout(aiPlay, 1500);
                    }
                }, 500);
            }, 400);
        }
        
        // –î–æ–±–æ—Ä –∫–∞—Ä—Ç
        function refillHands() {
            // –°–Ω–∞—á–∞–ª–∞ –∞—Ç–∞–∫—É—é—â–∏–π, –ø–æ—Ç–æ–º –∑–∞—â–∏—â–∞—é—â–∏–π—Å—è
            const firstHand = isPlayerAttacking ? playerHand : aiHand;
            const secondHand = isPlayerAttacking ? aiHand : playerHand;
            
            while (firstHand.length < 6 && deck.length > 0) {
                firstHand.push(deck.pop());
            }
            while (secondHand.length < 6 && deck.length > 0) {
                secondHand.push(deck.pop());
            }
            
            renderDeck();
            renderHands();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
        function checkWin() {
            if (deck.length > 0) return false;
            
            if (playerHand.length === 0 && aiHand.length === 0) {
                showMessage('ü§ù –ù–∏—á—å—è!', 5000);
                gameOver = true;
                return true;
            }
            
            if (playerHand.length === 0) {
                showMessage('üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏!', 5000);
                gameOver = true;
                launchConfetti();
                return true;
            }
            
            if (aiHand.length === 0) {
                showMessage('üòî –ö–æ–º–ø—å—é—Ç–µ—Ä –ø–æ–±–µ–¥–∏–ª!', 5000);
                gameOver = true;
                return true;
            }
            
            return false;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            const turnIndicator = document.getElementById('turnIndicator');
            const btnTake = document.getElementById('btnTake');
            const btnPass = document.getElementById('btnPass');
            const btnAdd = document.getElementById('btnAdd');
            
            if (isPlayerTurn) {
                turnIndicator.textContent = isPlayerAttacking ? '‚öîÔ∏è –í—ã –∞—Ç–∞–∫—É–µ—Ç–µ' : 'üõ°Ô∏è –í—ã –∑–∞—â–∏—â–∞–µ—Ç–µ—Å—å';
                turnIndicator.className = 'absolute top-4 right-4 text-xl px-4 py-2 rounded-xl ' + 
                    (isPlayerAttacking ? 'bg-red-600 text-white' : 'bg-blue-600 text-white');
            } else {
                turnIndicator.textContent = isPlayerAttacking ? 'üõ°Ô∏è –ö–æ–º–ø—å—é—Ç–µ—Ä –∑–∞—â–∏—â–∞–µ—Ç—Å—è' : '‚öîÔ∏è –ö–æ–º–ø—å—é—Ç–µ—Ä –∞—Ç–∞–∫—É–µ—Ç';
                turnIndicator.className = 'absolute top-4 right-4 text-xl px-4 py-2 rounded-xl bg-gray-600 text-white';
            }
            
            // –ö–Ω–æ–ø–∫–∏
            if (isPlayerTurn && !gameOver) {
                if (isPlayerAttacking) {
                    btnTake.classList.add('hidden');
                    btnPass.classList.toggle('hidden', tableCards.length === 0 || tableCards.some(p => !p.defense));
                    btnAdd.classList.toggle('hidden', tableCards.length === 0);
                } else {
                    btnTake.classList.toggle('hidden', tableCards.length === 0);
                    const allBeaten = tableCards.every(p => p.defense !== null);
                    btnPass.classList.toggle('hidden', !allBeaten || tableCards.length === 0);
                    btnAdd.classList.add('hidden');
                }
            } else {
                btnTake.classList.add('hidden');
                btnPass.classList.add('hidden');
                btnAdd.classList.add('hidden');
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, duration) {
            const msg = document.getElementById('gameMessage');
            msg.textContent = text;
            msg.classList.remove('hidden');
            
            setTimeout(() => {
                msg.classList.add('hidden');
            }, duration);
        }
        
        // –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
        function backToMenu() {
            document.getElementById('menu').classList.remove('hidden');
            document.getElementById('gameBoard').classList.add('hidden');
            gameOver = true;
        }
        
        // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ –ø—Ä–∏ –ø–æ–±–µ–¥–µ
        function launchConfetti() {
            const canvas = document.getElementById('confetti');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const confetti = [];
            const colors = ['#ff0', '#f0f', '#0ff', '#f00', '#0f0', '#00f'];
            
            for (let i = 0; i < 150; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    w: Math.random() * 10 + 5,
                    h: Math.random() * 6 + 3,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    speed: Math.random() * 3 + 2,
                    angle: Math.random() * Math.PI * 2,
                    spin: (Math.random() - 0.5) * 0.2
                });
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                let active = false;
                confetti.forEach(c => {
                    if (c.y < canvas.height) {
                        active = true;
                        c.y += c.speed;
                        c.x += Math.sin(c.angle) * 2;
                        c.angle += c.spin;
                        
                        ctx.save();
                        ctx.translate(c.x, c.y);
                        ctx.rotate(c.angle);
                        ctx.fillStyle = c.color;
                        ctx.fillRect(-c.w/2, -c.h/2, c.w, c.h);
                        ctx.restore();
                    }
                });
                
                if (active) {
                    requestAnimationFrame(animate);
                } else {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            }
            
            animate();
        }
    </script>
</body>
</html>